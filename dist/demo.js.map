{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/extension/EventEmitter.ts","webpack:///./src/extension/util/bindDecorator.ts","webpack:///./src/extension/enums.ts","webpack:///./src/extension/extension.ts","webpack:///./src/extension/util/debounce.ts","webpack:///./src/extension/SuggestSource.ts","webpack:///./src/extension/util/xhrRequest.ts","webpack:///./src/extension/util/searchVariants.ts","webpack:///./src/demo/UsersSuggestSource.ts","webpack:///./src/demo/demo.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","constants","EventEmitter","this","length","events","on","eventName","fn","_this","push","off","filter","eventFn","trigger","args","_i","arguments","event","forEach","apply","target","propertyKey","descriptor","typeOfFunction","TypeError","configurable","boolTrue","bound","writable","KEYS","INPUT","TOGGLE","SEARCH_DEBOUNCE","extension_PureSuggest","_super","PureSuggest","el","options","focused","toggle","index","Error","createSource","input","querySelector","toggleEl","suggestSource","initialData","doDelayedSearch","time","timeout","clearTimeout","setTimeout","debounce","doSearch","addEventListener","handleMouseDown","handleClick","handleKeyDown","handleFocus","handleBlur","__extends","initElements","document","createElement","className","innerHTML","appendChild","insertBefore","multi","style","display","focus","which","keyCode","UP","handleUp","DOWN","handleDown","ENTER","handleSelect","ESC","handleEsc","preventDefault","classList","add","addEl","remove","menuEl","menuItems","updateHovered","id","getAttribute","setValue","blur","getInputValue","trim","item","suggestItems","addBubble","title","search","then","items","updateMenu","handleItemClick","findDataItem","indexOf","handleItemMove","handleBubbleClose","stopPropagation","removeBubble","handleBubbleClick","check","parentNode","term","createMenu","fragment_1","createDocumentFragment","createMenuItem","notFoundEl","textContent","menuWrapEl","fragment","menuItemEl","titleEl","subtitleEl","highlight","hideAvatar","imageWrapEl","imageEl","setAttribute","image","createHighlight","subtitle","String","preEl","createTextNode","hlEl","postEl","bubblesEl","bubbleEl","bubbleTextEl","bubbleCloseEl","map","_a","bubble","removeChild","destroy","removeEventListener","__decorate","SuggestSource","enhanceError","message","config","response","code","error","statusCode","statusText","headers","encode","val","encodeURIComponent","replace","xhrRequest","Promise","resolve","reject","request","XMLHttpRequest","requestData","data","requestHeaders","parseJSON","FormData","simple","JSON","stringify","open","method","toUpperCase","url","params","serializedParams","URLSearchParams","toString","parts_1","keys","k","v","toISOString","join","buildURL","withCredentials","responseType","onreadystatechange","readyState","status","responseHeaders","parsed","split","line","substr","toLowerCase","concat","parseHeaders","getAllResponseHeaders","responseData","parse","e","settle","ontimeout","onerror","setRequestHeader","send","ENG_TABLE","a","b","g","z","u","f","h","KBR_MISS_TABLE",",","<","\\","|",";",":","q","y","j","[","{","w","x","]","}","'","\"",".",">","REV_KBR_MISS_TABLE","ф","и","м","п","в","у","я","ш","л","д","ь","т","щ","з","к","ы","е","г","а","р","с","memo","mapFromTable","str","table","strlen","result","char","getSearchVariants","self","UsersSuggestSource_UsersSuggestSource","UsersSuggestSource","fetch","window","__HOST","serialize","values","findFromCache","localSample","filterValues","slice","filterData","uniqConcat","find","sample","variants","searchCondition","some","arr","strLower_1","matched_1","index_1","variant","limit","substring","extension","__initialData"],"mappings":"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","file":"demo.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 72);\n","export class EventEmitter {\n    public length = 0;\n\n    protected events: {\n        [propName: string]: Function[];\n    };\n\n    constructor() {\n        this.events = {};\n    }\n\n    on(eventName: string, fn: Function) {\n        if (!this.events[eventName]) {\n            this.events[eventName] = [];\n        }\n\n        this.events[eventName].push(fn);\n        this.length++;\n\n        return () => this.off(eventName, fn);\n    }\n\n    off(eventName: string, fn: Function) {\n        this.events[eventName] = this.events[eventName].filter((eventFn) => fn !== eventFn);\n        this.length--;\n    }\n\n    trigger(eventName: string, ...args: any[]) {\n        let event = this.events[eventName];\n\n        if (event) {\n            event.forEach((fn) => fn(...args));\n        }\n    }\n}","namespace constants {\n    export const typeOfFunction: 'function' = 'function';\n    export const boolTrue: boolean = true;\n}\n\nexport function bind<T extends Function>(target: object, propertyKey: string, descriptor: TypedPropertyDescriptor<T>): TypedPropertyDescriptor<T> | void {\n    if(!descriptor || (typeof descriptor.value !== constants.typeOfFunction)) {\n        throw new TypeError(`Only methods can be decorated with @bind. <${propertyKey}> is not a method!`);\n    }\n    \n    return {\n        configurable: constants.boolTrue,\n        get(this: T): T {\n            const bound: T = descriptor.value!.bind(this);\n\n            Object.defineProperty(this, propertyKey, {\n                value: bound,\n                configurable: constants.boolTrue,\n                writable: constants.boolTrue\n            });\n\n            return bound;\n        }\n    };\n}\n\nexport default bind;","export enum KEYS {\n    UP = 38,\n    DOWN = 40,\n    ENTER = 13,\n    ESC = 27\n}","import {SuggestItem} from './interfaces';\nimport {SuggestSource} from './SuggestSource';\nimport {EventEmitter} from './EventEmitter';\nimport {debounce} from './util/debounce';\nimport {bind} from './util/bindDecorator';\nimport {KEYS} from './enums';\n\nimport './extension.less';\n\nexport interface ExtensionOptions {\n    hideAvatar?: boolean,\n    multi?: boolean,\n    initialData?: any[],\n    createSource: (initialData?: any[]) => SuggestSource\n}\n\nconst USER_NOT_FOUND = 'User not found';\nconst ADD = 'Add';\nconst FOCUSED = 'suggest_focused';\nconst FILLED = 'suggest_filled';\nconst INPUT = 'suggest__input';\nconst TOGGLE = 'suggest__toggle';\nconst ITEM_HOVERED = 'suggest-item_hovered';\nconst NOT_FOUND = 'suggest__not-found';\nconst MENU = 'suggest__menu';\nconst MENU_WRAP = 'suggest__menu-wrap';\nconst ITEM = 'suggest-item';\nconst ITEM_IMAGE = 'suggest-item__image';\nconst ITEM_TITLE = 'suggest-item__title';\nconst ITEM_SUBTITLE = 'suggest-item__subtitle';\nconst BUBBLES = 'suggest__bubbles';\nconst BUBBLES_ADD = 'suggest__add';\nconst BUBBLE = 'suggest-bubble';\nconst BUBBLE_TEXT = 'suggest-bubble__text';\nconst BUBBLE_CLOSE = 'suggest-bubble__close';\nconst SEARCH_DEBOUNCE = 250;\n\nexport class PureSuggest extends EventEmitter {\n    protected el: HTMLElement;\n    protected input: HTMLInputElement;\n    protected suggestSource: SuggestSource;\n    protected focused: boolean = false;\n    protected toggle: boolean = false;\n    protected toggleEl?: HTMLDivElement;\n    protected menuWrapEl?: HTMLDivElement;\n    protected menuEl?: HTMLDivElement;\n    protected menuItems?: HTMLDivElement[];\n    protected suggestItems?: SuggestItem[];\n    protected bubblesEl?: HTMLDivElement;\n    protected addEl?: HTMLDivElement;\n    protected index: number = 0;\n    protected options: ExtensionOptions;\n    protected value: SuggestItem[] = [];\n    protected doDelayedSearch: () => any;\n\n    constructor(el: HTMLDivElement, options: ExtensionOptions) {\n        super();\n\n        if (!el) {\n            throw new Error('element is required');\n        }\n\n        if (!options || !options.createSource) {\n            throw new Error('createSource is required');\n        }\n\n        // init\n        this.el = el;\n        this.input = this.el.querySelector('.' + INPUT);\n        this.toggleEl = this.el.querySelector('.' + TOGGLE);\n        this.suggestSource = options.createSource(options.initialData);\n        this.options = options;\n\n        // util\n        this.doDelayedSearch = debounce(this.doSearch, SEARCH_DEBOUNCE);\n\n        // listeners\n        this.el.addEventListener('mousedown', this.handleMouseDown);\n        this.el.addEventListener('click', this.handleClick);\n        this.input.addEventListener('keydown', this.handleKeyDown);\n        this.input.addEventListener('input', this.doDelayedSearch);\n        this.input.addEventListener('focus', this.handleFocus);\n        this.input.addEventListener('blur', this.handleBlur);\n    }\n\n    /**\n     * Init some elements if needed\n     */\n    initElements() {\n        // in case we need to create input by extension\n        if (!this.input) {\n            this.input = document.createElement('input');\n\n            this.input.className = INPUT;\n\n            // element can be filled with some additional nodes, clear it\n            this.el.innerHTML = '';\n            this.el.appendChild(this.input);\n        }\n\n        // in case we need to create toggle by extension\n        if (!this.toggleEl) {\n            this.toggleEl = document.createElement('div');\n\n            this.toggleEl.className = TOGGLE;\n\n            this.el.insertBefore(this.toggleEl, this.input);\n        }\n    }\n\n    /**\n     * Handle mousedown for proper toggle behaviour\n     */\n    @bind\n    handleMouseDown() {\n        if (this.focused) {\n            this.toggle = true;\n        }\n    }\n\n    /**\n     * Handle click on element itself to focus back\n     */\n    @bind\n    handleClick(event: Event) {\n        // just let input blur if toggle happened\n        if (event.target === this.toggleEl && this.toggle) {\n            this.toggle = false;\n\n            return;\n        }\n\n        if (this.options.multi) {\n            this.input.style.display = '';\n        }\n\n        this.input.focus();\n    }\n\n    /**\n     * Handle command keys\n     */\n    @bind\n    handleKeyDown(event: KeyboardEvent) {\n        let key = event.which || event.keyCode;\n\n        if (key === KEYS.UP) {\n            this.handleUp();\n        } else if (key === KEYS.DOWN) {\n            this.handleDown();\n        } else if (key === KEYS.ENTER) {\n            this.handleSelect();\n        } else if (key === KEYS.ESC) {\n            this.handleEsc();\n        } else {\n            return;\n        }\n\n        event.preventDefault();\n    }\n\n    /**\n     * Focus state\n     */\n    @bind\n    handleFocus() {\n        this.focused = true;\n\n        this.el.classList.add(FOCUSED);\n\n        if (this.options.multi && this.addEl) {\n            this.addEl.style.display = 'none';\n        }\n\n        this.doSearch();\n\n        this.trigger('focus');\n    }\n\n    /**\n     * Blur state\n     */\n    @bind\n    handleBlur() {\n        this.focused = false;\n\n        this.el.classList.remove(FOCUSED);\n\n        // toggle input and add element visibilities for multi-select\n        if (this.options.multi && !this.input.value) {\n            if (this.value.length) {\n                this.input.style.display = 'none';\n            } else {\n                this.input.style.display = '';\n            }\n\n            if (this.addEl) {\n                this.addEl.style.display = '';\n            }\n        }\n\n        if (this.menuEl) {\n            this.menuEl.style.display = 'none';\n        }\n\n        this.trigger('blur');\n    }\n\n    /**\n     * Handle KEYS.UP key\n     */\n    handleUp() {\n        if (!this.menuItems || this.index <= 0 || !this.focused) {\n            return;\n        }\n\n        this.updateHovered(this.index - 1);\n    }\n\n    /**\n     * Handle KEYS.DOWN key\n     */\n    handleDown() {\n        if (!this.menuItems || this.index >= this.menuItems.length - 1 || !this.focused) {\n            return;\n        }\n\n        this.updateHovered(this.index + 1);\n    }\n\n    /**\n     * Handle KEYS.ENTER key\n     */\n    handleSelect() {\n        if (!this.menuItems || !this.focused) {\n            return;\n        }\n\n        let id = this.menuItems[this.index].getAttribute('data-id');\n\n        this.setValue(id);\n\n        this.input.blur();\n    }\n\n    /**\n     * Handle KEYS.ESCAPE key\n     */\n    handleEsc() {\n        this.input.blur();\n    }\n\n    /**\n     * Return trimmed input value\n     */\n    getInputValue() {\n        return this.input.value.trim();\n    }\n\n    /**\n     * Update input value and ui state\n     */\n    setValue(id: string) {\n        let item = this.suggestItems[this.index];\n\n        this.index = 0;\n\n        if (this.options.multi) {\n            this.input.value = '';\n\n            this.value.push(item);\n\n            this.addBubble(item);\n        } else {\n            this.input.value = item.title;\n\n            this.value = [item];\n\n            this.trigger('change', id);\n        }\n    }\n\n    /**\n     * Search from suggest source\n     */\n    @bind\n    doSearch() {\n        this.suggestSource\n            .search(this.getInputValue(), this.options.multi ? this.value : [])\n            .then((items) => this.updateMenu(items));\n    }\n\n    /**\n     * Handle click on item in menu\n     */\n    @bind\n    handleItemClick(event: Event) {\n        let item = this.findDataItem(event.target as Element) as HTMLDivElement;\n\n        if (item) {\n            let id = item.getAttribute('data-id');\n\n            this.updateHovered(this.menuItems.indexOf(item));\n\n            this.setValue(id);\n        }\n    }\n\n    /**\n     * Handle item mouse move\n     */\n    @bind\n    handleItemMove(event: Event) {\n        let item = this.findDataItem(event.target as Element) as HTMLDivElement;\n\n        if (item) {\n            this.updateHovered(this.menuItems.indexOf(item));\n        }\n    }\n\n    /**\n     * Handle close button click on bubble\n     */\n    @bind\n    handleBubbleClose(event: Event) {\n        let target = event.target as Element;\n\n        event.stopPropagation();\n\n        if (target.className === BUBBLE_CLOSE) {\n            let item = this.findDataItem(event.target as Element) as HTMLDivElement;\n\n            if (item) {\n                this.removeBubble(item);\n            }\n        }\n    }\n\n    /**\n     * Stop events on bubble click\n     */\n    @bind\n    handleBubbleClick(event: Event) {\n        event.stopPropagation();\n    }\n\n    /**\n     * Find parent menu item\n     */\n    findDataItem(target: Element): Element | void {\n        let el = target,\n            check = () => el && el.getAttribute && el.getAttribute('data-id');\n\n        if (check()) {\n            return el;\n        }\n\n        while (el.parentNode) {\n            el = el.parentNode as Element;\n\n            if (check()) {\n                return el;\n            }\n        }\n    }\n\n    /**\n     * Update index and hovered menu item\n     */\n    updateHovered(index: number) {\n        this.menuItems[this.index].classList.remove(ITEM_HOVERED);\n\n        this.index = index;\n\n        this.menuItems[this.index].classList.add(ITEM_HOVERED);\n    }\n\n    /**\n     * Create menu if needed, create items according to suggest data\n     */\n    updateMenu(items: SuggestItem[]) {\n        let term = this.getInputValue();\n\n        this.menuItems = [];\n        this.suggestItems = items;\n\n        this.createMenu();\n\n        if (items.length) {\n            let fragment = document.createDocumentFragment();\n\n            this.index = 0;\n\n            items.forEach((item) => this.createMenuItem(item, fragment, term));\n\n            this.menuEl.appendChild(fragment);\n\n            this.updateHovered(this.index);\n        } else {\n            let notFoundEl = document.createElement('div');\n\n            notFoundEl.className = NOT_FOUND;\n            notFoundEl.textContent = USER_NOT_FOUND;\n\n            this.menuEl.appendChild(notFoundEl);\n        }\n    }\n\n    /**\n     * Create or update menu element\n     */\n    createMenu() {\n        if (this.menuEl) {\n            this.menuEl.innerHTML = '';\n            this.menuEl.style.display = '';\n        } else {\n            this.menuWrapEl = document.createElement('div');\n            this.menuEl = document.createElement('div');\n\n            this.menuWrapEl.className = MENU_WRAP;\n            this.menuEl.className = MENU;\n\n            this.el.appendChild(this.menuWrapEl);\n            this.menuWrapEl.appendChild(this.menuEl);\n\n            this.menuEl.addEventListener('mousedown', this.handleItemClick);\n            this.menuEl.addEventListener('mousemove', this.handleItemMove);\n        }\n    }\n\n    /**\n     * Create one menu item\n     */\n    createMenuItem(item: SuggestItem, fragment: DocumentFragment, term: string) {\n        let menuItemEl = document.createElement('div'),\n            titleEl = document.createElement('div'),\n            subtitleEl = document.createElement('div'),\n            highlight = this.suggestSource.highlight(item.title, term);\n\n        if (!this.options.hideAvatar) {\n            let imageWrapEl = document.createElement('div'),\n                imageEl = document.createElement('img');\n\n            imageEl.setAttribute('src', item.image);\n            imageEl.setAttribute('alt', item.title);\n\n            imageWrapEl.className = ITEM_IMAGE;\n\n            imageWrapEl.appendChild(imageEl);\n            menuItemEl.appendChild(imageWrapEl);\n        }\n\n        menuItemEl.className = ITEM;\n        titleEl.className = ITEM_TITLE;\n        subtitleEl.className = ITEM_SUBTITLE;\n\n        if (highlight.length <= 1) {\n            titleEl.textContent = item.title;\n        } else {\n            this.createHighlight(titleEl, highlight);\n        }\n\n        subtitleEl.textContent = item.subtitle;\n\n        menuItemEl.appendChild(titleEl);\n        menuItemEl.appendChild(subtitleEl);\n\n        menuItemEl.setAttribute('data-id', String(item.id));\n\n        fragment.appendChild(menuItemEl);\n\n        this.menuItems.push(menuItemEl);\n    }\n\n    /**\n     * Create highlight for one item\n     */\n    createHighlight(titleEl: HTMLDivElement, highlight: string[]) {\n        if (highlight[1] && highlight[1].trim()) {\n            let preEl = document.createTextNode(highlight[0]),\n                hlEl = document.createElement('span');\n\n            hlEl.textContent = highlight[1];\n\n            titleEl.appendChild(preEl);\n            titleEl.appendChild(hlEl);\n\n            if (highlight[2]) {\n                let postEl = document.createTextNode(highlight[2]);\n\n                titleEl.appendChild(postEl);\n            }\n        } else {\n            titleEl.textContent = highlight[0];\n        }\n    }\n\n    /**\n     * Add bubble for multi-suggest\n     */\n    addBubble(item: SuggestItem) {\n        if (!this.bubblesEl) {\n            this.bubblesEl = document.createElement('div');\n            this.addEl = document.createElement('div');\n\n            this.bubblesEl.className = BUBBLES;\n            this.addEl.className = BUBBLES_ADD;\n\n            this.addEl.textContent = ADD;\n\n            this.el.insertBefore(this.bubblesEl, this.input);\n            this.el.insertBefore(this.addEl, this.input);\n\n            this.bubblesEl.addEventListener('mousedown', this.handleBubbleClose);\n            this.bubblesEl.addEventListener('click', this.handleBubbleClick);\n        }\n\n        let bubbleEl = document.createElement('div'),\n            bubbleTextEl = document.createElement('div'),\n            bubbleCloseEl = document.createElement('div');\n\n        bubbleEl.className = BUBBLE;\n        bubbleTextEl.className = BUBBLE_TEXT;\n        bubbleCloseEl.className = BUBBLE_CLOSE;\n\n        bubbleEl.setAttribute('data-id', item.id);\n\n        bubbleTextEl.textContent = item.title;\n\n        bubbleEl.appendChild(bubbleTextEl);\n        bubbleEl.appendChild(bubbleCloseEl);\n        this.bubblesEl.appendChild(bubbleEl);\n\n        this.el.classList.add(FILLED);\n\n        this.trigger('change', this.value.map(({id}) => id));\n    }\n\n    /**\n     * Remove bubble for multi-suggest\n     */\n    removeBubble(bubble: HTMLDivElement) {\n        let id = bubble.getAttribute('data-id');\n\n        if (id) {\n            this.bubblesEl.removeChild(bubble);\n\n            this.value = this.value.filter((item) => item.id !== id);\n\n            if (!this.value.length) {\n                this.el.classList.remove(FILLED);\n\n                this.input.style.display = '';\n            }\n\n            this.trigger('change', this.value.map(({id}) => id));\n        }\n    }\n\n    /**\n     * Cleanup\n     */\n    destroy() {\n        this.suggestSource = null;\n        this.options = null;\n\n        this.el.removeEventListener('mousedown', this.handleMouseDown);\n        this.el.removeEventListener('click', this.handleClick);\n        this.input.removeEventListener('keydown', this.handleKeyDown);\n        this.input.removeEventListener('input', this.doDelayedSearch);\n        this.input.removeEventListener('focus', this.handleFocus);\n        this.input.removeEventListener('blur', this.handleBlur);\n\n        if (this.menuEl) {\n            this.menuEl.removeEventListener('mousedown', this.handleItemClick);\n            this.menuEl.removeEventListener('mousemove', this.handleItemMove);\n        }\n\n        if (this.bubblesEl) {\n            this.bubblesEl.removeEventListener('mousedown', this.handleBubbleClose);\n            this.bubblesEl.removeEventListener('click', this.handleBubbleClick);\n\n            this.el.removeChild(this.bubblesEl);\n            this.el.removeChild(this.addEl);\n        }\n\n        this.el.removeChild(this.menuWrapEl);\n\n        this.el = null;\n        this.input = null;\n        this.toggleEl = null;\n    }\n}","export function debounce(fn: Function, time?: number) {\n  let timeout: any;\n\n  return function(...args: any[]) {\n    clearTimeout(timeout);\n\n    timeout = setTimeout(() => fn(...args), time);\n  }\n}","import {Dict, SuggestItem} from './interfaces';\n\nexport abstract class SuggestSource {\n    abstract fetch(term: string): Promise<Dict[]>;\n\n    abstract serialize(data: Dict[]): SuggestItem[];\n\n    abstract search(term: string, values: SuggestItem[]): Promise<SuggestItem[]>;\n\n    abstract highlight(str: string, term: string): string[];\n}","import {Dict} from '../interfaces';\n\nexport interface XhrResponse {\n    data: any;\n    statusCode: number;\n    statusText: string;\n    headers: Dict;\n    request: XMLHttpRequest;\n    code?: string;\n}\n\nexport interface XhrError extends Error {\n    code: string;\n    config: Dict;\n    response?: {\n        statusCode: number;\n        statusText: string;\n        headers?: Dict;\n    };\n}\n\nexport interface XhrRequestParams {\n    method: string;\n    data?: any;\n    params?: any;\n    withCredentials?: boolean;\n    timeout?: number;\n    headers?: Dict;\n    simple?: boolean;\n    url: string;\n    parseJSON?: boolean;\n    responseType?: XMLHttpRequestResponseType;\n}\n\n/**\n * add params to error\n */\nfunction enhanceError(message: string, config: Dict, response?: XhrResponse | null, code?: string): XhrError {\n    let error = new Error(message) as XhrError;\n\n    if (response) {\n        error.response = {\n            statusCode: response.statusCode,\n            statusText: response.statusText,\n            headers: response.headers,\n        };\n    }\n\n    if (code) {\n        error.code = code;\n    }\n\n    error.config = config;\n\n    return error;\n}\n\n/**\n * safe encode\n */\nfunction encode(val: string): string {\n    return encodeURIComponent(val)\n        .replace(/%40/gi, '@')\n        .replace(/%3A/gi, ':')\n        .replace(/%24/g, '$')\n        .replace(/%2C/gi, ',')\n        .replace(/%20/g, '+')\n        .replace(/%5B/gi, '[')\n        .replace(/%5D/gi, ']');\n}\n\n/**\n * build url with query\n */\nfunction buildURL(url: string, params?: Dict): string {\n    if (!params) {\n        return url;\n    }\n\n    let serializedParams;\n\n    if (typeof URLSearchParams !== 'undefined' && params instanceof URLSearchParams) {\n        serializedParams = params.toString();\n    } else {\n        let parts: string[] = [];\n\n        Object.keys(params).forEach(function (key) {\n            let val = params[key];\n\n            if (val === null || typeof val === 'undefined') {\n                return;\n            }\n\n            if (Object.prototype.toString.call(val) === '[object Array]') {\n                key = key + '[]';\n            } else {\n                val = [val];\n            }\n\n            Object.keys(val).forEach(function (k) {\n                let v = val[k];\n\n                if (Object.prototype.toString.call(v) === '[object Date]') {\n                    v = v.toISOString();\n                } else if (typeof v === 'object') {\n                    v = JSON.stringify(v);\n                }\n\n                parts.push(encode(key) + '=' + encode(v));\n            });\n        });\n\n        serializedParams = parts.join('&');\n    }\n\n    if (serializedParams) {\n        url += (url.indexOf('?') === -1 ? '?' : '&') + serializedParams;\n    }\n\n    return url;\n}\n\n/**\n * parse headers with cookies\n */\nfunction parseHeaders(headers: string): Dict {\n    let parsed: Dict = {};\n\n    if (!headers) {\n        return parsed;\n    }\n\n    headers.split('\\n').forEach(function parser(line) {\n        let i = line.indexOf(':');\n        let key = line.substr(0, i).trim().toLowerCase();\n        let val = line.substr(i + 1).trim();\n\n        if (key) {\n            if (key === 'set-cookie') {\n                parsed[key] = (parsed[key] ? parsed[key] : []).concat([val]);\n            } else {\n                parsed[key] = parsed[key] ? parsed[key] + ', ' + val : val;\n            }\n        }\n    });\n\n    return parsed;\n}\n\n/**\n * process xhrRequest result\n */\nfunction settle(resolve: Function, reject: Function, config: Dict, response: XhrResponse) {\n    let {statusCode} = response;\n\n    if (!statusCode || (statusCode >= 200 && statusCode < 300)) {\n        resolve(response);\n    } else {\n        reject(enhanceError(\n            'Request failed with status code ' + response.statusCode,\n            config,\n            response\n        ));\n    }\n}\n\n/**\n * make xhr request\n */\nexport function xhrRequest(options: XhrRequestParams): Promise<XhrResponse> {\n    return new Promise((resolve: Function, reject: Function) => {\n        let request = new XMLHttpRequest();\n        let requestData = options.data;\n        let requestHeaders = options.headers || {};\n        let parseJSON = typeof options.parseJSON === 'boolean' ? options.parseJSON : true;\n\n        if (requestData instanceof FormData || options.simple) {\n            delete requestHeaders['Content-Type']; // Let the browser set header\n        } else {\n            requestHeaders['Content-Type'] = 'application/json';\n        }\n\n        if (typeof requestData === 'object') {\n            requestData = JSON.stringify(requestData);\n        }\n\n        request.open(options.method.toUpperCase(), buildURL(options.url, options.params), true);\n\n        if (options.withCredentials) {\n            request.withCredentials = true;\n        }\n\n        if (options.timeout) {\n            request.timeout = options.timeout;\n        }\n\n        request.responseType = options.responseType || 'json';\n\n        request.onreadystatechange = () => {\n            if (!request || request.readyState !== 4) {\n                return;\n            }\n\n            // onerror\n            if (request.status === 0) {\n                return;\n            }\n\n            let responseHeaders = parseHeaders(request.getAllResponseHeaders());\n            let responseData = request.response;\n\n            if (parseJSON && request.response) {\n                try {\n                    responseData = JSON.parse(responseData);\n                } catch (e) {\n                    // still allow to receive response\n                }\n            }\n\n            settle(resolve, reject, options, {\n                data: responseData,\n                statusCode: request.status,\n                statusText: request.status === 1223 ? 'No Content' : request.statusText,\n                headers: responseHeaders,\n                request: request,\n            });\n        };\n\n        request.ontimeout = () => reject(enhanceError(\n            'Timeout of ' + options.timeout + 'ms exceeded',\n            options,\n            null,\n            'ECONNABORTED'\n        ));\n\n        request.onerror = () => reject(enhanceError('Network Error', options, {\n            data: '',\n            statusCode: 0,\n            statusText: 'Network Error',\n            headers: {},\n            request: request,\n        }));\n\n        if (!options.simple) {\n            Object.keys(requestHeaders).forEach((key) => {\n                let val = requestHeaders[key];\n\n                if (typeof requestData === 'undefined' && key.toLowerCase() === 'content-type') {\n                    delete requestHeaders[key];\n                } else {\n                    request.setRequestHeader(key, val);\n                }\n            });\n        }\n\n        if (typeof requestData === 'undefined') {\n            requestData = null;\n        }\n\n        request.send(requestData);\n    });\n}","import {Dict} from '../interfaces';\n\nconst ENG_TABLE = {\n    'a': 'а',\n    'b': 'б',\n    'v': 'в',\n    'g': 'г',\n    'd': 'д',\n    'e': 'е',\n    'z': 'з',\n    'i': 'и',\n    'k': 'к',\n    'l': 'л',\n    'm': 'м',\n    'n': 'н',\n    'o': 'о',\n    'p': 'п',\n    'r': 'р',\n    's': 'с',\n    't': 'т',\n    'u': 'у',\n    'f': 'ф',\n    'h': 'х',\n    'c': 'ц'\n};\n\nconst KBR_MISS_TABLE = {\n    'f': 'а',\n    ',': 'б',\n    '<': 'б',\n    'd': 'в',\n    'u': 'г',\n    'l': 'д',\n    't': 'е',\n    '\\\\': 'ё',\n    '|': 'ё',\n    ';': 'ж',\n    ':': 'ж',\n    'p': 'з',\n    'b': 'и',\n    'q': 'й',\n    'r': 'к',\n    'k': 'л',\n    'v': 'м',\n    'y': 'н',\n    'j': 'о',\n    'g': 'п',\n    'h': 'р',\n    'c': 'с',\n    'n': 'т',\n    'e': 'у',\n    'a': 'ф',\n    '[': 'х',\n    '{': 'х',\n    'w': 'ц',\n    'x': 'ч',\n    'i': 'ш',\n    'o': 'щ',\n    ']': 'ъ',\n    '}': 'ъ',\n    's': 'ы',\n    'm': 'ь',\n    '\\'': 'э',\n    '\"': 'э',\n    '.': 'ю',\n    '>': 'ю',\n    'z': 'я'\n};\n\nconst REV_KBR_MISS_TABLE = {\n    'ф': 'а',\n    'и': 'б',\n    'м': 'в',\n    'п': 'г',\n    'в': 'д',\n    'у': 'е',\n    'я': 'з',\n    'ш': 'и',\n    'л': 'к',\n    'д': 'л',\n    'ь': 'м',\n    'т': 'н',\n    'щ': 'о',\n    'з': 'п',\n    'к': 'р',\n    'ы': 'с',\n    'е': 'т',\n    'г': 'у',\n    'а': 'ф',\n    'р': 'х',\n    'с': 'ц'\n}\n\nlet memo: Dict = {};\n\nfunction mapFromTable(str: string, table: Dict): string {\n    let strlen = str.length,\n        result: string[] = [];\n\n    for (let i = 0; i < strlen; i++) {\n        let char = str[i];\n\n        result.push(table[char] || char);\n    }\n\n    return result.join('');\n}\n\nexport function getSearchVariants(str: string): string[] {\n    if (!memo[str]) {\n        memo[str] = [\n            str,\n            mapFromTable(str, ENG_TABLE),\n            mapFromTable(str, KBR_MISS_TABLE),\n            mapFromTable(str, REV_KBR_MISS_TABLE)\n        ].filter((value, index, self) => self.indexOf(value) === index);\n    }\n\n    return memo[str];\n}\n","import {SuggestSource} from '../extension/SuggestSource';\nimport {Dict, SuggestItem} from '../extension/interfaces';\nimport {xhrRequest} from '../extension/util/xhrRequest';\nimport {getSearchVariants} from '../extension/util/searchVariants';\n\nconst SAMPLE_SIZE = 5;\n\nexport class UsersSuggestSource extends SuggestSource {\n    private initialData: any[];\n    private data: any[];\n\n    constructor(initialData?: any[]) {\n        super();\n\n        this.initialData = initialData || [];\n    }\n\n    fetch(term: string): Promise<Dict[]> {\n        return xhrRequest({\n            method: 'GET',\n            url: window.__HOST + '/api/user/hint.php',\n            params: {\n                q: term\n            }\n        }).then(({data}) => {\n            this.data = data;\n\n            return data;\n        });\n    }\n\n    serialize(data: any[]): SuggestItem[] {\n        return data.map((item: any[]) => {\n            return {\n                id: item[0],\n                image: item[3],\n                title: item[1],\n                subtitle: item[2]\n            };\n        });\n    }\n\n    search(term: string, values: SuggestItem[]): Promise<SuggestItem[]> {\n        let items = this.findFromCache(term),\n            localSample = this.filterValues(items, values).slice(0, SAMPLE_SIZE);\n\n        // enough to display\n        if (localSample.length === SAMPLE_SIZE) {\n            return Promise.resolve(this.serialize(localSample));\n        }\n\n        // if not enough to display, try to fill with uniq data from server\n        return this.fetch(term).then((data) => {\n            let filterData = this.filterValues(data, values),\n                uniqConcat = localSample.concat(filterData.filter((item) => {\n                    return !localSample.find((sample) => sample[0] === item[0]);\n                }));\n\n            return this.serialize(uniqConcat.slice(0, SAMPLE_SIZE));\n        });\n    }\n\n    findFromCache(term: string) {\n        if (!term.trim()) {\n            return this.initialData;\n        }\n\n        let variants = getSearchVariants(term);\n\n        return this.initialData.filter((item) => this.searchCondition(item, variants));\n    }\n\n    searchCondition(item: any[], variants: string[]) {\n        let name = item[1].toLowerCase();\n\n        return variants.some((term) => name.indexOf(term) !== -1);\n    }\n\n    filterValues(arr: any[], values: SuggestItem[]): any[] {\n        if (!values.length) {\n            return arr;\n        }\n\n        return arr.filter((item) => !values.find((value) => value.id === item[0]));\n    }\n\n    highlight(str: string, term: string): string[] {\n        if (term.trim()) {\n            let strLower = str.toLowerCase(),\n                variants = getSearchVariants(term),\n                matched = '',\n                index = -1;\n\n            variants.forEach((variant) => {\n                if (index === -1) {\n                    index = strLower.indexOf(variant);\n\n                    matched = variant;\n                }\n            });\n\n            if (matched && index !== -1) {\n                let limit = index + matched.length;\n\n                return [\n                    str.substring(0, index),\n                    str.substring(index, limit),\n                    str.substring(limit, str.length)\n                ]\n            }\n        }\n\n        return [str];\n    }\n}","import {PureSuggest} from \"../extension/extension\";\nimport {UsersSuggestSource} from './UsersSuggestSource';\n\ndocument.addEventListener('DOMContentLoaded', function () {\n    new PureSuggest(document.querySelector('.suggest_default'), {\n        initialData: window.__initialData,\n        createSource: (data) => new UsersSuggestSource(data)\n    });\n\n    new PureSuggest(document.querySelector('.suggest_text'), {\n        initialData: window.__initialData,\n        createSource: (data) => new UsersSuggestSource(data),\n        hideAvatar: true\n    });\n\n    new PureSuggest(document.querySelector('.suggest_multi'), {\n        initialData: window.__initialData,\n        createSource: (data) => new UsersSuggestSource(data),\n        multi: true\n    });\n});"],"sourceRoot":""}