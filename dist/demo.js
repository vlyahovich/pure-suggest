!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=78)}({6:function(e,t,n){"use strict";n.r(t);var i,r=function(){function e(){this.length=0,this.events={}}return e.prototype.on=function(e,t){var n=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this.length++,function(){return n.off(e,t)}},e.prototype.off=function(e,t){this.events[e]=this.events[e].filter(function(e){return t!==e}),this.length--},e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=this.events[e];i&&i.forEach(function(e){return e.apply(void 0,t)})},e}();function s(e,t,n){if(!n||typeof n.value!==i.typeOfFunction)throw new TypeError("Only methods can be decorated with @bind. <"+t+"> is not a method!");return{configurable:i.boolTrue,get:function(){var e=n.value.bind(this);return Object.defineProperty(this,t,{value:e,configurable:i.boolTrue,writable:i.boolTrue}),e}}}!function(e){e.typeOfFunction="function",e.boolTrue=!0}(i||(i={}));var o;!function(e){e[e.UP=38]="UP",e[e.DOWN=40]="DOWN",e[e.ENTER=13]="ENTER",e[e.ESC=27]="ESC"}(o||(o={}));n(79);n.d(t,"PureSuggest",function(){return p});var u=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),l=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},a="suggest__input",h="suggest__toggle",c=250,d=200,p=function(e){function t(t,n){var i=e.call(this)||this;if(i.focused=!1,i.toggle=!1,i.index=0,i.value=[],!t)throw new Error("element is required");if(!n||!n.createSource)throw new Error("createSource is required");return i.el=t,i.input=i.el.querySelector("."+a),i.toggleEl=i.el.querySelector("."+h),i.suggestSource=n.createSource(n.initialData),i.options=n,i.initElements(),i.doDelayedSearch=function(e,t){var n;return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];clearTimeout(n),n=setTimeout(function(){return e.apply(void 0,i)},t)}}(i.doSearch,c),i.handleMenuScroll=function(e,t){var n,i=!1;return function r(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];i?n=s:(e.apply(void 0,s),i=!0,setTimeout(function(){n&&(r.apply(void 0,n),n=null),i=!1},t))}}(i.handleMenuScroll,d),i.el.addEventListener("mousedown",i.handleMouseDown),i.el.addEventListener("click",i.handleClick),i.input.addEventListener("keydown",i.handleKeyDown),i.input.addEventListener("input",i.doDelayedSearch),i.input.addEventListener("focus",i.handleFocus),i.input.addEventListener("blur",i.handleBlur),i}return u(t,e),t.prototype.initElements=function(){this.input||(this.input=document.createElement("input"),this.input.className=a,this.el.innerHTML="",this.el.appendChild(this.input)),this.toggleEl||(this.toggleEl=document.createElement("div"),this.toggleEl.className=h,this.el.insertBefore(this.toggleEl,this.input))},t.prototype.handleMouseDown=function(){this.focused&&(this.toggle=!0)},t.prototype.handleClick=function(e){e.target===this.toggleEl&&this.toggle?this.toggle=!1:(this.options.multi&&(this.input.style.display=""),this.input.focus())},t.prototype.handleKeyDown=function(e){var t=e.which||e.keyCode;if(t===o.UP)this.handleUp();else if(t===o.DOWN)this.handleDown();else if(t===o.ENTER)this.handleSelect();else{if(t!==o.ESC)return;this.handleEsc()}e.preventDefault()},t.prototype.handleFocus=function(){this.focused=!0,this.el.classList.add("suggest_focused"),this.options.multi&&this.addEl&&(this.addEl.style.display="none"),this.doSearch(),this.trigger("focus")},t.prototype.handleBlur=function(){this.focused=!1,this.menuEl&&(this.menuEl.scrollTop=0,this.menuEl.style.display="none"),this.el.classList.remove("suggest_focused"),this.options.multi&&!this.input.value&&(this.value.length?this.input.style.display="none":this.input.style.display="",this.addEl&&(this.addEl.style.display="")),this.trigger("blur")},t.prototype.handleUp=function(){!this.menuItems||this.index<=0||!this.focused||this.updateHovered(this.index-1)},t.prototype.handleDown=function(){!this.menuItems||this.index>=this.menuItems.length-1||!this.focused||this.updateHovered(this.index+1)},t.prototype.handleSelect=function(){if(this.menuItems&&this.focused){var e=this.menuItems[this.index].getAttribute("data-id");this.setValue(e),this.input.blur()}},t.prototype.handleEsc=function(){this.input.blur()},t.prototype.getInputValue=function(){return this.input.value.trim()},t.prototype.setValue=function(e){var t=this.suggestItems[this.index];this.index=0,this.options.multi?(this.input.value="",this.value.push(t),this.addBubble(t)):(this.input.value=t.title,this.value=[t],this.trigger("change",e))},t.prototype.doSearch=function(){var e=this;this.suggestSource.search(this.getInputValue(),this.options.multi?this.value:[]).then(function(t){return e.updateMenu(t)})},t.prototype.handleItemClick=function(e){var t=this.findDataItem(e.target);if(t){var n=t.getAttribute("data-id");this.updateHovered(this.menuItems.indexOf(t)),this.setValue(n)}},t.prototype.handleItemMove=function(e){var t=this.findDataItem(e.target);t&&this.updateHovered(this.menuItems.indexOf(t))},t.prototype.handleMenuScroll=function(){var e=this;if(!this.currentRequest&&this.suggestSource.hasNextPage()){var t=this.menuEl.scrollTop;this.menuScrollHeight-t<1e3&&(this.currentRequest=this.suggestSource.nextPage().then(function(t){e.addMenu(t),e.currentRequest=null}))}},t.prototype.handleBubbleClose=function(e){var t=e.target;if(e.stopPropagation(),"suggest-bubble__close"===t.className){var n=this.findDataItem(e.target);n&&this.removeBubble(n)}},t.prototype.handleBubbleClick=function(e){e.stopPropagation()},t.prototype.findDataItem=function(e){var t=e,n=function(){return t&&t.getAttribute&&t.getAttribute("data-id")};if(n())return t;for(;t.parentNode;)if(t=t.parentNode,n())return t},t.prototype.updateHovered=function(e){this.menuItems[this.index].classList.remove("suggest-item_hovered"),this.index=e,this.menuItems[this.index].classList.add("suggest-item_hovered")},t.prototype.updateMenu=function(e){var t=this,n=this.getInputValue();if(this.menuItems=[],this.suggestItems=e,this.createMenu(),e.length){var i=document.createDocumentFragment();this.index=0,e.forEach(function(e){return t.createMenuItem(e,i,n)}),this.menuEl.appendChild(i),this.updateHovered(this.index)}else{var r=document.createElement("div");r.className="suggest__not-found",r.textContent="User not found",this.menuEl.appendChild(r)}this.menuScrollHeight=this.menuEl.scrollHeight},t.prototype.addMenu=function(e){var t=this;if(this.menuEl){var n=this.getInputValue();if(this.suggestItems=this.suggestItems.concat(e),e.length){var i=document.createDocumentFragment();e.forEach(function(e){return t.createMenuItem(e,i,n)}),this.menuEl.appendChild(i)}this.menuScrollHeight=this.menuEl.scrollHeight}},t.prototype.createMenu=function(){this.menuEl?(this.menuEl.innerHTML="",this.menuEl.style.display="",this.menuEl.scrollTop=0):(this.menuWrapEl=document.createElement("div"),this.menuEl=document.createElement("div"),this.menuWrapEl.className="suggest__menu-wrap",this.menuEl.className="suggest__menu",this.el.appendChild(this.menuWrapEl),this.menuWrapEl.appendChild(this.menuEl),this.menuEl.addEventListener("mousedown",this.handleItemClick),this.menuEl.addEventListener("mousemove",this.handleItemMove),this.menuEl.addEventListener("scroll",this.handleMenuScroll))},t.prototype.createMenuItem=function(e,t,n){var i=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),o=this.suggestSource.highlight(e.title,n);if(!this.options.hideAvatar&&e.image){var u=document.createElement("div"),l=document.createElement("img"),a=new Image;l.setAttribute("src",e.image),l.setAttribute("alt",e.title),u.className="suggest-item__image",u.appendChild(l),i.appendChild(u),a.onload=function(){return u.classList.add("suggest-item__image_loaded")},a.src=e.image}i.className="suggest-item",r.className="suggest-item__title",s.className="suggest-item__subtitle",o.length<=1?r.textContent=e.title:this.createHighlight(r,o),s.textContent=e.subtitle,i.appendChild(r),i.appendChild(s),i.setAttribute("data-id",String(e.id)),t.appendChild(i),this.menuItems.push(i)},t.prototype.createHighlight=function(e,t){if(t[1]&&t[1].trim()){var n=document.createTextNode(t[0]),i=document.createElement("span");if(i.textContent=t[1],e.appendChild(n),e.appendChild(i),t[2]){var r=document.createTextNode(t[2]);e.appendChild(r)}}else e.textContent=t[0]},t.prototype.addBubble=function(e){this.bubblesEl||(this.bubblesEl=document.createElement("div"),this.addEl=document.createElement("div"),this.bubblesEl.className="suggest__bubbles",this.addEl.className="suggest__add",this.addEl.textContent="Add",this.el.insertBefore(this.bubblesEl,this.input),this.el.insertBefore(this.addEl,this.input),this.bubblesEl.addEventListener("mousedown",this.handleBubbleClose),this.bubblesEl.addEventListener("click",this.handleBubbleClick));var t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div");t.className="suggest-bubble",n.className="suggest-bubble__text",i.className="suggest-bubble__close",t.setAttribute("data-id",e.id),n.textContent=e.title,t.appendChild(n),t.appendChild(i),this.bubblesEl.appendChild(t),this.el.classList.add("suggest_filled"),this.trigger("change",this.value.map(function(e){return e.id}))},t.prototype.removeBubble=function(e){var t=e.getAttribute("data-id");t&&(this.bubblesEl.removeChild(e),this.value=this.value.filter(function(e){return e.id!==t}),this.value.length||(this.el.classList.remove("suggest_filled"),this.input.style.display=""),this.trigger("change",this.value.map(function(e){return e.id})))},t.prototype.destroy=function(){this.suggestSource=null,this.options=null,this.el.removeEventListener("mousedown",this.handleMouseDown),this.el.removeEventListener("click",this.handleClick),this.input.removeEventListener("keydown",this.handleKeyDown),this.input.removeEventListener("input",this.doDelayedSearch),this.input.removeEventListener("focus",this.handleFocus),this.input.removeEventListener("blur",this.handleBlur),this.menuEl&&(this.menuEl.removeEventListener("mousedown",this.handleItemClick),this.menuEl.removeEventListener("mousemove",this.handleItemMove),this.menuEl.removeEventListener("scroll",this.handleMenuScroll)),this.bubblesEl&&(this.bubblesEl.removeEventListener("mousedown",this.handleBubbleClose),this.bubblesEl.removeEventListener("click",this.handleBubbleClick),this.el.removeChild(this.bubblesEl),this.el.removeChild(this.addEl)),this.menuWrapEl&&this.el.removeChild(this.menuWrapEl),this.el=null,this.input=null,this.toggleEl=null,this.events={}},l([s],t.prototype,"handleMouseDown",null),l([s],t.prototype,"handleClick",null),l([s],t.prototype,"handleKeyDown",null),l([s],t.prototype,"handleFocus",null),l([s],t.prototype,"handleBlur",null),l([s],t.prototype,"doSearch",null),l([s],t.prototype,"handleItemClick",null),l([s],t.prototype,"handleItemMove",null),l([s],t.prototype,"handleMenuScroll",null),l([s],t.prototype,"handleBubbleClose",null),l([s],t.prototype,"handleBubbleClick",null),t}(r)},78:function(e,t,n){"use strict";n.r(t);var i=n(6),r=function(){return function(){}}();function s(e,t,n,i){var r=new Error(e);return n&&(r.response={statusCode:n.statusCode,statusText:n.statusText,headers:n.headers}),i&&(r.code=i),r.config=t,r}function o(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function u(e){return new Promise(function(t,n){var i=new XMLHttpRequest,r=e.data,u=e.headers||{},l="boolean"!=typeof e.parseJSON||e.parseJSON;r instanceof FormData||e.simple?delete u["Content-Type"]:u["Content-Type"]="application/json","object"==typeof r&&(r=JSON.stringify(r)),i.open(e.method.toUpperCase(),function(e,t){if(!t)return e;var n;if("undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams)n=t.toString();else{var i=[];Object.keys(t).forEach(function(e){var n=t[e];null!==n&&void 0!==n&&("[object Array]"===Object.prototype.toString.call(n)?e+="[]":n=[n],Object.keys(n).forEach(function(t){var r=n[t];"[object Date]"===Object.prototype.toString.call(r)?r=r.toISOString():"object"==typeof r&&(r=JSON.stringify(r)),i.push(o(e)+"="+o(r))}))}),n=i.join("&")}return n&&(e+=(-1===e.indexOf("?")?"?":"&")+n),e}(e.url,e.params),!0),e.withCredentials&&(i.withCredentials=!0),e.timeout&&(i.timeout=e.timeout),i.responseType=e.responseType||"json",i.onreadystatechange=function(){if(i&&4===i.readyState&&0!==i.status){var r=function(e){var t={};return e?(e.split("\n").forEach(function(e){var n=e.indexOf(":"),i=e.substr(0,n).trim().toLowerCase(),r=e.substr(n+1).trim();i&&(t[i]="set-cookie"===i?(t[i]?t[i]:[]).concat([r]):t[i]?t[i]+", "+r:r)}),t):t}(i.getAllResponseHeaders()),o=i.response;if(l&&i.response)try{o=JSON.parse(o)}catch(e){}!function(e,t,n,i){var r=i.statusCode;!r||r>=200&&r<300?e(i):t(s("Request failed with status code "+i.statusCode,n,i))}(t,n,e,{data:o,statusCode:i.status,statusText:1223===i.status?"No Content":i.statusText,headers:r,request:i})}},i.ontimeout=function(){return n(s("Timeout of "+e.timeout+"ms exceeded",e,null,"ECONNABORTED"))},i.onerror=function(){return n(s("Network Error",e,{data:"",statusCode:0,statusText:"Network Error",headers:{},request:i}))},e.simple||Object.keys(u).forEach(function(e){var t=u[e];void 0===r&&"content-type"===e.toLowerCase()?delete u[e]:i.setRequestHeader(e,t)}),void 0===r&&(r=null),i.send(r)})}var l={a:"а",b:"б",v:"в",g:"г",d:"д",e:"е",z:"з",i:"и",k:"к",l:"л",m:"м",n:"н",o:"о",p:"п",r:"р",s:"с",t:"т",u:"у",f:"ф",h:"х",c:"ц"},a={f:"а",",":"б","<":"б",d:"в",u:"г",l:"д",t:"е","\\":"ё","|":"ё",";":"ж",":":"ж",p:"з",b:"и",q:"й",r:"к",k:"л",v:"м",y:"н",j:"о",g:"п",h:"р",c:"с",n:"т",e:"у",a:"ф","[":"х","{":"х",w:"ц",x:"ч",i:"ш",o:"щ","]":"ъ","}":"ъ",s:"ы",m:"ь","'":"э",'"':"э",".":"ю",">":"ю",z:"я"},h={"ф":"а","и":"б","м":"в","п":"г","в":"д","у":"е","я":"з","ш":"и","л":"к","д":"л","ь":"м","т":"н","щ":"о","з":"п","к":"р","ы":"с","е":"т","г":"у","а":"ф","р":"х","с":"ц"},c={};function d(e,t){for(var n=e.length,i=[],r=0;r<n;r++){var s=e[r];i.push(t[s]||s)}return i.join("")}function p(e){return c[e]||(c[e]=[e,d(e,l),d(e,a),d(e,h)].filter(function(e,t,n){return n.indexOf(e)===t})),c[e]}var f=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),m=function(e){function t(t){var n=e.call(this)||this;return n.initialData=t||[],n}return f(t,e),t.prototype.fetch=function(e,t){return u({method:"GET",url:window.__HOST+"/api/user/hint.php",params:{q:e,p:t,ps:30}}).then(function(e){return e.data})},t.prototype.serialize=function(e){return e.map(function(e){return{id:e[0],image:e[3],title:e[1],subtitle:e[2]}})},t.prototype.search=function(e,t,n){var i=this;void 0===n&&(n=1);var r=this.findFromCache(e,n),s=this.filterValues(r,t);return this.term=e,this.values=t,this.page=n,30===s.length?(this.data=s,Promise.resolve(this.serialize(s))):this.fetch(e,n).then(function(e){var n=i.filterValues(e,t),r=s.concat(n.filter(function(e){return!s.find(function(t){return t[0]===e[0]})}));return i.data=r,i.serialize(r)})},t.prototype.hasNextPage=function(){return this.data.length>=30},t.prototype.nextPage=function(){return this.hasNextPage()?this.search(this.term,this.values,this.page+1):Promise.resolve([])},t.prototype.findFromCache=function(e,t){var n=this,i=30*t-30,r=i+30;if(!e.trim())return this.initialData.slice(i,r);var s=p(e);return this.initialData.filter(function(e){return n.searchCondition(e,s)}).slice(i,r)},t.prototype.searchCondition=function(e,t){var n=e[1].toLowerCase();return t.some(function(e){return-1!==n.indexOf(e)})},t.prototype.filterValues=function(e,t){return t.length?e.filter(function(e){return!t.find(function(t){return t.id===e[0]})}):e},t.prototype.highlight=function(e,t){if(t.trim()){var n=e.toLowerCase(),i="",r=-1;if(p(t).forEach(function(e){-1===r&&(r=n.indexOf(e),i=e)}),i&&-1!==r){var s=r+i.length;return[e.substring(0,r),e.substring(r,s),e.substring(s,e.length)]}}return[e]},t}(r);document.addEventListener("DOMContentLoaded",function(){new i.PureSuggest(document.querySelector(".suggest_default"),{initialData:window.__initialData,createSource:function(e){return new m(e)}}),new i.PureSuggest(document.querySelector(".suggest_text"),{initialData:window.__initialData,createSource:function(e){return new m(e)},hideAvatar:!0}),new i.PureSuggest(document.querySelector(".suggest_multi"),{initialData:window.__initialData,createSource:function(e){return new m(e)},multi:!0})})},79:function(e,t){}});
//# sourceMappingURL=demo.js.map