{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/extension/util/EventEmitter.ts","webpack:///./src/extension/enums.ts","webpack:///./src/extension/extension.ts","webpack:///./src/extension/util/debounce.ts","webpack:///./src/extension/SuggestSource.ts","webpack:///./src/extension/util/xhrRequest.ts","webpack:///./src/extension/util/searchVariants.ts","webpack:///./src/demo/UsersSuggestSource.ts","webpack:///./src/demo/demo.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","KEYS","EventEmitter","this","length","events","on","eventName","fn","_this","push","off","filter","eventFn","trigger","args","_i","arguments","event","forEach","apply","SEARCH_DEBOUNCE","extension_PureSuggest","_super","PureSuggest","el","options","focused","index","createSource","Error","input","querySelector","suggestSource","initialData","handleSelfClick","handleKeyDown","handleFocus","handleBlur","doImmSearch","doSearch","time","timeout","clearTimeout","setTimeout","debounce","handleItemClick","handleItemMove","handleBubbleClose","addEventListener","__extends","multi","style","display","focus","which","keyCode","UP","handleUp","DOWN","handleDown","ENTER","handleSelect","ESC","handleEsc","preventDefault","classList","add","addEl","remove","menuEl","menuItems","updateHovered","id","getAttribute","setValue","blur","getInputValue","trim","item","suggestItems","addBubble","title","search","then","items","updateMenu","findDataItem","target","indexOf","stopPropagation","className","removeBubble","handleBubbleClick","check","parentNode","term","innerHTML","menuWrapEl","document","createElement","appendChild","fragment_1","createDocumentFragment","createMenuItem","notFoundEl","textContent","fragment","menuItemEl","titleEl","subtitleEl","highlight","hideAvatar","imageWrapEl","imageEl","setAttribute","image","createHighlight","subtitle","String","preEl","createTextNode","hlEl","postEl","bubblesEl","insertBefore","bubbleEl","bubbleTextEl","bubbleCloseEl","map","_a","bubble","removeChild","destroy","removeEventListener","SuggestSource","enhanceError","message","config","response","code","error","statusCode","statusText","headers","encode","val","encodeURIComponent","replace","xhrRequest","Promise","resolve","reject","request","XMLHttpRequest","requestData","data","requestHeaders","parseJSON","FormData","simple","JSON","stringify","open","method","toUpperCase","url","params","serializedParams","URLSearchParams","toString","parts_1","keys","k","v","toISOString","join","buildURL","withCredentials","responseType","onreadystatechange","readyState","status","responseHeaders","parsed","split","line","substr","toLowerCase","concat","parseHeaders","getAllResponseHeaders","responseData","parse","e","settle","ontimeout","onerror","setRequestHeader","send","ENG_TABLE","a","b","g","z","u","f","h","KBR_MISS_TABLE",",","<","\\","|",";",":","q","y","j","[","{","w","x","]","}","'","\"",".",">","REV_KBR_MISS_TABLE","ф","и","м","п","в","у","я","ш","л","д","ь","т","щ","з","к","ы","е","г","а","р","с","memo","mapFromTable","str","table","strlen","result","char","getSearchVariants","self","UsersSuggestSource_UsersSuggestSource","UsersSuggestSource","fetch","serialize","values","findFromCache","localSample","filterValues","slice","filterData","uniqConcat","find","sample","variants","searchCondition","some","arr","strLower_1","matched_1","index_1","variant","limit","substring","extension","window","__initialData"],"mappings":"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","file":"demo.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 72);\n","export class EventEmitter {\n    public length = 0;\n\n    protected events: {\n        [propName: string]: Function[];\n    };\n\n    constructor() {\n        this.events = {};\n    }\n\n    on(eventName: string, fn: Function) {\n        if (!this.events[eventName]) {\n            this.events[eventName] = [];\n        }\n\n        this.events[eventName].push(fn);\n        this.length++;\n\n        return () => this.off(eventName, fn);\n    }\n\n    off(eventName: string, fn: Function) {\n        this.events[eventName] = this.events[eventName].filter((eventFn) => fn !== eventFn);\n        this.length--;\n    }\n\n    trigger(eventName: string, ...args: any[]) {\n        let event = this.events[eventName];\n\n        if (event) {\n            event.forEach((fn) => fn(...args));\n        }\n    }\n}","export enum KEYS {\n    UP = 38,\n    DOWN = 40,\n    ENTER = 13,\n    ESC = 27\n}","import {SuggestItem} from './interfaces';\nimport {SuggestSource} from './SuggestSource';\nimport {EventEmitter} from './util/EventEmitter';\nimport {debounce} from './util/debounce';\nimport {KEYS} from './enums';\n\nimport './extension.less';\n\nexport interface ExtensionOptions {\n    hideAvatar?: boolean,\n    multi?: boolean,\n    initialData?: any[],\n    createSource: (initialData?: any[]) => SuggestSource\n}\n\nconst FOCUSED = 'suggest_focused';\nconst ITEM_HOVERED = 'suggest-item_hovered';\nconst SEARCH_DEBOUNCE = 250;\n\nexport class PureSuggest extends EventEmitter {\n    protected el: HTMLElement;\n    protected input: HTMLInputElement;\n    protected suggestSource: SuggestSource;\n    protected focused: boolean = false;\n    protected menuWrapEl?: HTMLDivElement;\n    protected menuEl?: HTMLDivElement;\n    protected menuItems?: HTMLDivElement[];\n    protected suggestItems?: SuggestItem[];\n    protected bubblesEl?: HTMLDivElement;\n    protected addEl?: HTMLDivElement;\n    protected index: number = 0;\n    protected options: ExtensionOptions;\n    protected value: SuggestItem[] = [];\n    protected doImmSearch: Function;\n\n    constructor(el: HTMLDivElement, options: ExtensionOptions) {\n        super();\n\n        if (!options || !options.createSource) {\n            throw new Error('createSource is required');\n        }\n\n        // init\n        this.el = el;\n        this.input = this.el.querySelector('.suggest__input');\n        this.suggestSource = options.createSource(options.initialData);\n        this.options = options;\n\n        // bindings\n        this.handleSelfClick = this.handleSelfClick.bind(this);\n        this.handleKeyDown = this.handleKeyDown.bind(this);\n        this.handleFocus = this.handleFocus.bind(this);\n        this.handleBlur = this.handleBlur.bind(this);\n        this.doImmSearch = this.doSearch.bind(this);\n        this.doSearch = debounce(this.doImmSearch, SEARCH_DEBOUNCE);\n        this.handleItemClick = this.handleItemClick.bind(this);\n        this.handleItemMove = this.handleItemMove.bind(this);\n        this.handleBubbleClose = this.handleBubbleClose.bind(this);\n        this.handleBubbleClose = this.handleBubbleClose.bind(this);\n\n        // listeners\n        this.el.addEventListener('click', this.handleSelfClick);\n        this.input.addEventListener('keydown', this.handleKeyDown);\n        this.input.addEventListener('input', this.doSearch);\n        this.input.addEventListener('focus', this.handleFocus);\n        this.input.addEventListener('blur', this.handleBlur);\n    }\n\n    /**\n     * Hnndle click on element itself to focus back\n     */\n    handleSelfClick() {\n        if (this.options.multi) {\n            this.input.style.display = '';\n        }\n\n        this.input.focus();\n    }\n\n    /**\n     * Handle command keys\n     */\n    handleKeyDown(event: KeyboardEvent) {\n        let key = event.which || event.keyCode;\n\n        if (key === KEYS.UP) {\n            this.handleUp();\n        } else if (key === KEYS.DOWN) {\n            this.handleDown();\n        } else if (key === KEYS.ENTER) {\n            this.handleSelect();\n        } else if (key === KEYS.ESC) {\n            this.handleEsc();\n        } else {\n            return;\n        }\n\n        event.preventDefault();\n    }\n\n    /**\n     * Focus state\n     */\n    handleFocus() {\n        this.focused = true;\n\n        this.el.classList.add(FOCUSED);\n\n        if (this.options.multi && this.addEl) {\n            this.addEl.style.display = 'none';\n        }\n\n        this.doImmSearch();\n\n        this.trigger('focus');\n    }\n\n    /**\n     * Blur state\n     */\n    handleBlur() {\n        this.focused = false;\n\n        this.el.classList.remove(FOCUSED);\n\n        if (this.options.multi) {\n            if (this.value.length) {\n                this.input.style.display = 'none';\n            } else {\n                this.input.style.display = '';\n            }\n\n            if (this.addEl) {\n                this.addEl.style.display = '';\n            }\n        }\n\n        if (this.menuEl) {\n            this.menuEl.style.display = 'none';\n        }\n\n        this.trigger('blur');\n    }\n\n    /**\n     * Handle KEYS.UP key\n     */\n    handleUp() {\n        if (!this.menuItems || this.index <= 0 || !this.focused) {\n            return;\n        }\n\n        this.updateHovered(this.index - 1);\n    }\n\n    /**\n     * Handle KEYS.DOWN key\n     */\n    handleDown() {\n        if (!this.menuItems || this.index >= this.menuItems.length - 1 || !this.focused) {\n            return;\n        }\n\n        this.updateHovered(this.index + 1);\n    }\n\n    /**\n     * Handle KEYS.ENTER key\n     */\n    handleSelect() {\n        if (!this.menuItems) {\n            return;\n        }\n\n        let id = this.menuItems[this.index].getAttribute('data-id');\n\n        this.setValue(id);\n\n        this.input.blur();\n    }\n\n    /**\n     * Handle KEYS.ESCAPE key\n     */\n    handleEsc() {\n        this.input.blur();\n    }\n\n    /**\n     * Return trimmed input value\n     */\n    getInputValue() {\n        return this.input.value.trim();\n    }\n\n    /**\n     * Update input value and ui state\n     */\n    setValue(id: string) {\n        let item = this.suggestItems[this.index];\n\n        this.index = 0;\n\n        if (this.options.multi) {\n            this.input.value = '';\n\n            this.value.push(item);\n\n            this.addBubble(item);\n        } else {\n            this.input.value = item.title;\n\n            this.value = [item];\n\n            this.trigger('change', id);\n        }\n    }\n\n    /**\n     * Search from suggest source\n     */\n    doSearch() {\n        this.suggestSource\n            .search(this.getInputValue(), this.options.multi ? this.value : [])\n            .then((items) => this.updateMenu(items));\n    }\n\n    /**\n     * Handle click on item in menu\n     */\n    handleItemClick(event: Event) {\n        let item = this.findDataItem(event.target as Element) as HTMLDivElement;\n\n        if (item) {\n            let id = item.getAttribute('data-id');\n\n            this.updateHovered(this.menuItems.indexOf(item));\n\n            this.setValue(id);\n        }\n    }\n\n    /**\n     * Handle item mouse move\n     */\n    handleItemMove(event: Event) {\n        let item = this.findDataItem(event.target as Element) as HTMLDivElement;\n\n        if (item) {\n            this.updateHovered(this.menuItems.indexOf(item));\n        }\n    }\n\n    /**\n     * Handle close button click on bubble\n     */\n    handleBubbleClose(event: Event) {\n        let target = event.target as Element;\n\n        event.stopPropagation();\n\n        if (target.className === 'suggest-bubble__close') {\n            let item = this.findDataItem(event.target as Element) as HTMLDivElement;\n\n            if (item) {\n                this.removeBubble(item);\n            }\n        }\n    }\n\n    /**\n     * Stop events on bubble click\n     */\n    handleBubbleClick(event: Event) {\n        event.stopPropagation();\n    }\n\n    /**\n     * Find parent menu item\n     */\n    findDataItem(target: Element): Element | void {\n        let el = target,\n            check = () => el && el.getAttribute && el.getAttribute('data-id');\n\n        if (check()) {\n            return el;\n        }\n\n        while (el.parentNode) {\n            el = el.parentNode as Element;\n\n            if (check()) {\n                return el;\n            }\n        }\n    }\n\n    /**\n     * Update index and hovered menu item\n     */\n    updateHovered(index: number) {\n        this.menuItems[this.index].classList.remove(ITEM_HOVERED);\n\n        this.index = index;\n\n        this.menuItems[this.index].classList.add(ITEM_HOVERED);\n    }\n\n    /**\n     * Create menu if needed, create items according to suggest data\n     */\n    updateMenu(items: SuggestItem[]) {\n        let term = this.getInputValue();\n\n        this.menuItems = [];\n        this.suggestItems = items;\n\n        if (this.menuEl) {\n            this.menuEl.innerHTML = '';\n            this.menuEl.style.display = '';\n        } else {\n            this.menuWrapEl = document.createElement('div');\n            this.menuEl = document.createElement('div');\n\n            this.menuWrapEl.className = 'suggest__menu-wrap';\n            this.menuEl.className = 'suggest__menu';\n\n            this.el.appendChild(this.menuWrapEl);\n            this.menuWrapEl.appendChild(this.menuEl);\n\n            this.menuEl.addEventListener('mousedown', this.handleItemClick);\n            this.menuEl.addEventListener('mousemove', this.handleItemMove);\n        }\n\n        if (items.length) {\n            let fragment = document.createDocumentFragment();\n\n            this.index = 0;\n\n            items.forEach((item) => this.createMenuItem(item, fragment, term));\n\n            this.menuEl.appendChild(fragment);\n\n            this.updateHovered(this.index);\n        } else {\n            let notFoundEl = document.createElement('div');\n\n            notFoundEl.className = 'suggest__not-found';\n            notFoundEl.textContent = 'User not found';\n\n            this.menuEl.appendChild(notFoundEl);\n        }\n    }\n\n    /**\n     * Create one menu item\n     */\n    createMenuItem(item: SuggestItem, fragment: DocumentFragment, term: string) {\n        let menuItemEl = document.createElement('div'),\n            titleEl = document.createElement('div'),\n            subtitleEl = document.createElement('div'),\n            highlight = this.suggestSource.highlight(item.title, term);\n\n        if (!this.options.hideAvatar) {\n            let imageWrapEl = document.createElement('div'),\n                imageEl = document.createElement('img');\n\n            imageEl.setAttribute('src', item.image);\n            imageEl.setAttribute('alt', item.title);\n\n            imageWrapEl.className = 'suggest-item__image';\n\n            imageWrapEl.appendChild(imageEl);\n            menuItemEl.appendChild(imageWrapEl);\n        }\n\n        menuItemEl.className = 'suggest-item';\n        titleEl.className = 'suggest-item__title';\n        subtitleEl.className = 'suggest-item__subtitle';\n\n        if (highlight.length <= 1) {\n            titleEl.textContent = item.title;\n        } else {\n            this.createHighlight(titleEl, highlight);\n        }\n\n        subtitleEl.textContent = item.subtitle;\n\n        menuItemEl.appendChild(titleEl);\n        menuItemEl.appendChild(subtitleEl);\n\n        menuItemEl.setAttribute('data-id', String(item.id));\n\n        fragment.appendChild(menuItemEl);\n\n        this.menuItems.push(menuItemEl);\n    }\n\n    /**\n     * Create highlight for one item\n     */\n    createHighlight(titleEl: HTMLDivElement, highlight: string[]) {\n        if (highlight[1] && highlight[1].trim()) {\n            let preEl = document.createTextNode(highlight[0]),\n                hlEl = document.createElement('span');\n\n            hlEl.textContent = highlight[1];\n\n            titleEl.appendChild(preEl);\n            titleEl.appendChild(hlEl);\n\n            if (highlight[2]) {\n                let postEl = document.createTextNode(highlight[2]);\n\n                titleEl.appendChild(postEl);\n            }\n        } else {\n            titleEl.textContent = highlight[0];\n        }\n    }\n\n    /**\n     * Add bubble for multi-suggest\n     */\n    addBubble(item: SuggestItem) {\n        if (!this.bubblesEl) {\n            this.bubblesEl = document.createElement('div');\n            this.addEl = document.createElement('div');\n\n            this.bubblesEl.className = 'suggest__bubbles';\n            this.addEl.className = 'suggest__add';\n\n            this.addEl.textContent = 'Add';\n\n            this.el.insertBefore(this.bubblesEl, this.input);\n            this.el.insertBefore(this.addEl, this.input);\n\n            this.bubblesEl.addEventListener('mousedown', this.handleBubbleClose);\n            this.bubblesEl.addEventListener('click', this.handleBubbleClick);\n        }\n\n        let bubbleEl = document.createElement('div'),\n            bubbleTextEl = document.createElement('div'),\n            bubbleCloseEl = document.createElement('div');\n\n        bubbleEl.className = 'suggest-bubble';\n        bubbleTextEl.className = 'suggest-bubble__text';\n        bubbleCloseEl.className = 'suggest-bubble__close';\n\n        bubbleEl.setAttribute('data-id', item.id);\n\n        bubbleTextEl.textContent = item.title;\n\n        bubbleEl.appendChild(bubbleTextEl);\n        bubbleEl.appendChild(bubbleCloseEl);\n        this.bubblesEl.appendChild(bubbleEl);\n\n        this.el.classList.add('suggest_filled');\n\n        this.trigger('change', this.value.map(({id}) => id));\n    }\n\n    /**\n     * Remove bubble for multi-suggest\n     */\n    removeBubble(bubble: HTMLDivElement) {\n        let id = bubble.getAttribute('data-id');\n\n        if (id) {\n            this.bubblesEl.removeChild(bubble);\n\n            this.value = this.value.filter((item) => item.id !== id);\n\n            if (!this.value.length) {\n                this.el.classList.remove('suggest_filled');\n\n                this.input.style.display = '';\n            }\n\n            this.trigger('change', this.value.map(({id}) => id));\n        }\n    }\n\n    /**\n     * Cleanup\n     */\n    destroy() {\n        this.suggestSource = null;\n        this.options = null;\n\n        this.el.removeEventListener('click', this.handleSelfClick);\n        this.input.removeEventListener('keydown', this.handleKeyDown);\n        this.input.removeEventListener('input', this.doSearch);\n        this.input.removeEventListener('focus', this.handleFocus);\n        this.input.removeEventListener('blur', this.handleBlur);\n\n        if (this.menuEl) {\n            this.menuEl.removeEventListener('mousedown', this.handleItemClick);\n            this.menuEl.removeEventListener('mousemove', this.handleItemMove);\n        }\n\n        if (this.bubblesEl) {\n            this.bubblesEl.removeEventListener('mousedown', this.handleBubbleClose);\n            this.bubblesEl.removeEventListener('click', this.handleBubbleClick);\n\n            this.el.removeChild(this.bubblesEl);\n            this.el.removeChild(this.addEl);\n        }\n\n        this.el.removeChild(this.menuWrapEl);\n\n        this.el = null;\n        this.input = null;\n    }\n}","export function debounce(fn: Function, time?: number) {\n  let timeout: any;\n\n  return function(...args: any[]) {\n    clearTimeout(timeout);\n\n    timeout = setTimeout(() => fn(...args), time);\n  }\n}","import {Dict, SuggestItem} from './interfaces';\n\nexport abstract class SuggestSource {\n    abstract fetch(term: string): Promise<Dict[]>;\n\n    abstract serialize(data: Dict[]): SuggestItem[];\n\n    abstract search(term: string, values: SuggestItem[]): Promise<SuggestItem[]>;\n\n    abstract highlight(str: string, term: string): string[];\n\n    abstract find(id: string): any;\n}","import {Dict} from '../interfaces';\n\nexport interface XhrResponse {\n    data: any;\n    statusCode: number;\n    statusText: string;\n    headers: Dict;\n    request: XMLHttpRequest;\n    code?: string;\n}\n\nexport interface XhrError extends Error {\n    code: string;\n    config: Dict;\n    response?: {\n        statusCode: number;\n        statusText: string;\n        headers?: Dict;\n    };\n}\n\nexport interface XhrRequestParams {\n    method: string;\n    data?: any;\n    params?: any;\n    withCredentials?: boolean;\n    timeout?: number;\n    headers?: Dict;\n    simple?: boolean;\n    url: string;\n    parseJSON?: boolean;\n    responseType?: XMLHttpRequestResponseType;\n}\n\n/**\n * add params to error\n */\nfunction enhanceError(message: string, config: Dict, response?: XhrResponse | null, code?: string): XhrError {\n    let error = new Error(message) as XhrError;\n\n    if (response) {\n        error.response = {\n            statusCode: response.statusCode,\n            statusText: response.statusText,\n            headers: response.headers,\n        };\n    }\n\n    if (code) {\n        error.code = code;\n    }\n\n    error.config = config;\n\n    return error;\n}\n\n/**\n * safe encode\n */\nfunction encode(val: string): string {\n    return encodeURIComponent(val)\n        .replace(/%40/gi, '@')\n        .replace(/%3A/gi, ':')\n        .replace(/%24/g, '$')\n        .replace(/%2C/gi, ',')\n        .replace(/%20/g, '+')\n        .replace(/%5B/gi, '[')\n        .replace(/%5D/gi, ']');\n}\n\n/**\n * build url with query\n */\nfunction buildURL(url: string, params?: Dict): string {\n    if (!params) {\n        return url;\n    }\n\n    let serializedParams;\n\n    if (typeof URLSearchParams !== 'undefined' && params instanceof URLSearchParams) {\n        serializedParams = params.toString();\n    } else {\n        let parts: string[] = [];\n\n        Object.keys(params).forEach(function (key) {\n            let val = params[key];\n\n            if (val === null || typeof val === 'undefined') {\n                return;\n            }\n\n            if (Object.prototype.toString.call(val) === '[object Array]') {\n                key = key + '[]';\n            } else {\n                val = [val];\n            }\n\n            Object.keys(val).forEach(function (k) {\n                let v = val[k];\n\n                if (Object.prototype.toString.call(v) === '[object Date]') {\n                    v = v.toISOString();\n                } else if (typeof v === 'object') {\n                    v = JSON.stringify(v);\n                }\n\n                parts.push(encode(key) + '=' + encode(v));\n            });\n        });\n\n        serializedParams = parts.join('&');\n    }\n\n    if (serializedParams) {\n        url += (url.indexOf('?') === -1 ? '?' : '&') + serializedParams;\n    }\n\n    return url;\n}\n\n/**\n * parse headers with cookies\n */\nfunction parseHeaders(headers: string): Dict {\n    let parsed: Dict = {};\n\n    if (!headers) {\n        return parsed;\n    }\n\n    headers.split('\\n').forEach(function parser(line) {\n        let i = line.indexOf(':');\n        let key = line.substr(0, i).trim().toLowerCase();\n        let val = line.substr(i + 1).trim();\n\n        if (key) {\n            if (key === 'set-cookie') {\n                parsed[key] = (parsed[key] ? parsed[key] : []).concat([val]);\n            } else {\n                parsed[key] = parsed[key] ? parsed[key] + ', ' + val : val;\n            }\n        }\n    });\n\n    return parsed;\n}\n\n/**\n * process xhrRequest result\n */\nfunction settle(resolve: Function, reject: Function, config: Dict, response: XhrResponse) {\n    let {statusCode} = response;\n\n    if (!statusCode || (statusCode >= 200 && statusCode < 300)) {\n        resolve(response);\n    } else {\n        reject(enhanceError(\n            'Request failed with status code ' + response.statusCode,\n            config,\n            response\n        ));\n    }\n}\n\n/**\n * make xhr request\n */\nexport function xhrRequest(options: XhrRequestParams): Promise<XhrResponse> {\n    return new Promise((resolve: Function, reject: Function) => {\n        let request = new XMLHttpRequest();\n        let requestData = options.data;\n        let requestHeaders = options.headers || {};\n        let parseJSON = typeof options.parseJSON === 'boolean' ? options.parseJSON : true;\n\n        if (requestData instanceof FormData || options.simple) {\n            delete requestHeaders['Content-Type']; // Let the browser set header\n        } else {\n            requestHeaders['Content-Type'] = 'application/json';\n        }\n\n        if (typeof requestData === 'object') {\n            requestData = JSON.stringify(requestData);\n        }\n\n        request.open(options.method.toUpperCase(), buildURL(options.url, options.params), true);\n\n        if (options.withCredentials) {\n            request.withCredentials = true;\n        }\n\n        if (options.timeout) {\n            request.timeout = options.timeout;\n        }\n\n        request.responseType = options.responseType || 'json';\n\n        request.onreadystatechange = () => {\n            if (!request || request.readyState !== 4) {\n                return;\n            }\n\n            // onerror\n            if (request.status === 0) {\n                return;\n            }\n\n            let responseHeaders = parseHeaders(request.getAllResponseHeaders());\n            let responseData = request.response;\n\n            if (parseJSON && request.response) {\n                try {\n                    responseData = JSON.parse(responseData);\n                } catch (e) {\n                    // still allow to receive response\n                }\n            }\n\n            settle(resolve, reject, options, {\n                data: responseData,\n                statusCode: request.status,\n                statusText: request.status === 1223 ? 'No Content' : request.statusText,\n                headers: responseHeaders,\n                request: request,\n            });\n        };\n\n        request.ontimeout = () => reject(enhanceError(\n            'Timeout of ' + options.timeout + 'ms exceeded',\n            options,\n            null,\n            'ECONNABORTED'\n        ));\n\n        request.onerror = () => reject(enhanceError('Network Error', options, {\n            data: '',\n            statusCode: 0,\n            statusText: 'Network Error',\n            headers: {},\n            request: request,\n        }));\n\n        if (!options.simple) {\n            Object.keys(requestHeaders).forEach((key) => {\n                let val = requestHeaders[key];\n\n                if (typeof requestData === 'undefined' && key.toLowerCase() === 'content-type') {\n                    delete requestHeaders[key];\n                } else {\n                    request.setRequestHeader(key, val);\n                }\n            });\n        }\n\n        if (typeof requestData === 'undefined') {\n            requestData = null;\n        }\n\n        request.send(requestData);\n    });\n}","import {Dict} from '../interfaces';\n\nconst ENG_TABLE = {\n    'a': 'а',\n    'b': 'б',\n    'v': 'в',\n    'g': 'г',\n    'd': 'д',\n    'e': 'е',\n    'z': 'з',\n    'i': 'и',\n    'k': 'к',\n    'l': 'л',\n    'm': 'м',\n    'n': 'н',\n    'o': 'о',\n    'p': 'п',\n    'r': 'р',\n    's': 'с',\n    't': 'т',\n    'u': 'у',\n    'f': 'ф',\n    'h': 'х',\n    'c': 'ц'\n};\n\nconst KBR_MISS_TABLE = {\n    'f': 'а',\n    ',': 'б',\n    '<': 'б',\n    'd': 'в',\n    'u': 'г',\n    'l': 'д',\n    't': 'е',\n    '\\\\': 'ё',\n    '|': 'ё',\n    ';': 'ж',\n    ':': 'ж',\n    'p': 'з',\n    'b': 'и',\n    'q': 'й',\n    'r': 'к',\n    'k': 'л',\n    'v': 'м',\n    'y': 'н',\n    'j': 'о',\n    'g': 'п',\n    'h': 'р',\n    'c': 'с',\n    'n': 'т',\n    'e': 'у',\n    'a': 'ф',\n    '[': 'х',\n    '{': 'х',\n    'w': 'ц',\n    'x': 'ч',\n    'i': 'ш',\n    'o': 'щ',\n    ']': 'ъ',\n    '}': 'ъ',\n    's': 'ы',\n    'm': 'ь',\n    '\\'': 'э',\n    '\"': 'э',\n    '.': 'ю',\n    '>': 'ю',\n    'z': 'я'\n};\n\nconst REV_KBR_MISS_TABLE = {\n    'ф': 'а',\n    'и': 'б',\n    'м': 'в',\n    'п': 'г',\n    'в': 'д',\n    'у': 'е',\n    'я': 'з',\n    'ш': 'и',\n    'л': 'к',\n    'д': 'л',\n    'ь': 'м',\n    'т': 'н',\n    'щ': 'о',\n    'з': 'п',\n    'к': 'р',\n    'ы': 'с',\n    'е': 'т',\n    'г': 'у',\n    'а': 'ф',\n    'р': 'х',\n    'с': 'ц'\n}\n\nlet memo: Dict = {};\n\nfunction mapFromTable(str: string, table: Dict): string {\n    let strlen = str.length,\n        result: string[] = [];\n\n    for (let i = 0; i < strlen; i++) {\n        let char = str[i];\n\n        result.push(table[char] || char);\n    }\n\n    return result.join('');\n}\n\nexport function getSearchVariants(str: string): string[] {\n    if (!memo[str]) {\n        memo[str] = [\n            str,\n            mapFromTable(str, ENG_TABLE),\n            mapFromTable(str, KBR_MISS_TABLE),\n            mapFromTable(str, REV_KBR_MISS_TABLE)\n        ].filter((value, index, self) => self.indexOf(value) === index);\n    }\n\n    return memo[str];\n}\n","import {SuggestSource} from '../extension/SuggestSource';\nimport {Dict, SuggestItem} from '../extension/interfaces';\nimport {xhrRequest} from '../extension/util/xhrRequest';\nimport {getSearchVariants} from '../extension/util/searchVariants';\n\nconst SAMPLE_SIZE = 5;\n\nexport class UsersSuggestSource extends SuggestSource {\n    private initialData: any[];\n    private data: any[];\n\n    constructor(initialData?: any[]) {\n        super();\n\n        this.initialData = initialData || [];\n    }\n\n    fetch(term: string): Promise<Dict[]> {\n        return xhrRequest({\n            method: 'GET',\n            url: '/pure-suggest/api/user/hint.php',\n            params: {\n                q: term\n            }\n        }).then(({data}) => {\n            this.data = data;\n\n            return data;\n        });\n    }\n\n    serialize(data: any[]): SuggestItem[] {\n        return data.map((item: any[]) => {\n            return {\n                id: item[0],\n                image: item[3],\n                title: item[1],\n                subtitle: item[2]\n            };\n        });\n    }\n\n    search(term: string, values: SuggestItem[]): Promise<SuggestItem[]> {\n        let items = this.findFromCache(term),\n            localSample = this.filterValues(items, values).slice(0, SAMPLE_SIZE);\n\n        // enough to display\n        if (localSample.length === SAMPLE_SIZE) {\n            return Promise.resolve(this.serialize(localSample));\n        }\n\n        // if not enough to display, try to fill with uniq data from server\n        return this.fetch(term).then((data) => {\n            let filterData = this.filterValues(data, values),\n                uniqConcat = localSample.concat(filterData.filter((item) => {\n                    return !localSample.find((sample) => sample[0] === item[0]);\n                }));\n\n            return this.serialize(uniqConcat.slice(0, SAMPLE_SIZE));\n        });\n    }\n\n    findFromCache(term: string) {\n        if (!term.trim()) {\n            return this.initialData;\n        }\n\n        let variants = getSearchVariants(term);\n\n        return this.initialData.filter((item) => this.searchCondition(item, variants));\n    }\n\n    searchCondition(item: any[], variants: string[]) {\n        let name = item[1].toLowerCase();\n\n        return variants.some((term) => name.indexOf(term) !== -1);\n    }\n\n    filterValues(arr: any[], values: SuggestItem[]): any[] {\n        if (!values.length) {\n            return arr;\n        }\n\n        return arr.filter((item) => !values.find((value) => value.id === item[0]));\n    }\n\n    find(id: string): any {\n        return this.data.find((item) => item[0] === id);\n    }\n\n    highlight(str: string, term: string): string[] {\n        if (term.trim()) {\n            let strLower = str.toLowerCase(),\n                variants = getSearchVariants(term),\n                matched = '',\n                index = -1;\n\n            variants.forEach((variant) => {\n                if (index === -1) {\n                    index = strLower.indexOf(variant);\n\n                    matched = variant;\n                }\n            });\n\n            if (matched && index !== -1) {\n                let limit = index + matched.length;\n\n                return [\n                    str.substring(0, index),\n                    str.substring(index, limit),\n                    str.substring(limit, str.length)\n                ]\n            }\n        }\n\n        return [str];\n    }\n}","import {PureSuggest} from \"../extension/extension\";\nimport {UsersSuggestSource} from './UsersSuggestSource';\n\ndocument.addEventListener('DOMContentLoaded', function () {\n    new PureSuggest(document.querySelector('.suggest_default'), {\n        initialData: (window as any).__initialData,\n        createSource: (data) => new UsersSuggestSource(data)\n    });\n\n    new PureSuggest(document.querySelector('.suggest_text'), {\n        initialData: (window as any).__initialData,\n        createSource: (data) => new UsersSuggestSource(data),\n        hideAvatar: true\n    });\n\n    new PureSuggest(document.querySelector('.suggest_multi'), {\n        initialData: (window as any).__initialData,\n        createSource: (data) => new UsersSuggestSource(data),\n        multi: true\n    });\n});"],"sourceRoot":""}